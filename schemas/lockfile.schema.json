{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/AmadeusITGroup/prompt-registry/schemas/lockfile.schema.json",
  "title": "Prompt Registry Lockfile",
  "description": "Schema for prompt-registry.lock.json files that track repository-level bundle installations",
  "type": "object",
  "required": [
    "$schema",
    "version",
    "generatedAt",
    "generatedBy",
    "bundles",
    "sources"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON schema reference for validation",
      "examples": [
        "https://github.com/AmadeusITGroup/prompt-registry/schemas/lockfile.schema.json"
      ]
    },
    "version": {
      "type": "string",
      "description": "Lockfile schema version",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": [
        "1.0.0"
      ]
    },
    "generatedAt": {
      "type": "string",
      "description": "ISO 8601 timestamp when the lockfile was generated",
      "format": "date-time",
      "examples": [
        "2026-01-13T10:30:00.000Z"
      ]
    },
    "generatedBy": {
      "type": "string",
      "description": "Extension name and version that generated the lockfile",
      "examples": [
        "prompt-registry@1.0.0"
      ]
    },
    "bundles": {
      "type": "object",
      "description": "Map of bundle IDs to their metadata",
      "additionalProperties": {
        "$ref": "#/definitions/bundleEntry"
      }
    },
    "sources": {
      "type": "object",
      "description": "Map of source IDs to their configuration",
      "additionalProperties": {
        "$ref": "#/definitions/sourceEntry"
      }
    },
    "hubs": {
      "type": "object",
      "description": "Optional map of hub IDs to their configuration",
      "additionalProperties": {
        "$ref": "#/definitions/hubEntry"
      }
    },
    "profiles": {
      "type": "object",
      "description": "Optional map of profile IDs to their configuration",
      "additionalProperties": {
        "$ref": "#/definitions/profileEntry"
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "bundleEntry": {
      "type": "object",
      "description": "Bundle entry in the lockfile",
      "required": [
        "version",
        "sourceId",
        "sourceType",
        "installedAt",
        "commitMode",
        "files"
      ],
      "properties": {
        "version": {
          "type": "string",
          "description": "Semantic version of the installed bundle",
          "examples": [
            "1.0.0",
            "2.1.3"
          ]
        },
        "sourceId": {
          "type": "string",
          "description": "ID of the source this bundle was installed from",
          "minLength": 1
        },
        "sourceType": {
          "type": "string",
          "description": "Type of the source",
          "enum": [
            "github",
            "gitlab",
            "http",
            "local",
            "awesome-copilot",
            "local-awesome-copilot",
            "apm",
            "local-apm",
            "olaf",
            "local-olaf"
          ]
        },
        "installedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp when bundle was installed",
          "format": "date-time"
        },
        "commitMode": {
          "type": "string",
          "description": "Whether files are committed to Git or excluded",
          "enum": [
            "commit",
            "local-only"
          ]
        },
        "checksum": {
          "type": "string",
          "description": "Optional checksum of the bundle archive"
        },
        "files": {
          "type": "array",
          "description": "List of installed files with their checksums",
          "items": {
            "$ref": "#/definitions/fileEntry"
          }
        }
      },
      "additionalProperties": false
    },
    "fileEntry": {
      "type": "object",
      "description": "File entry within a bundle",
      "required": [
        "path",
        "checksum"
      ],
      "properties": {
        "path": {
          "type": "string",
          "description": "Relative path from repository root",
          "minLength": 1,
          "examples": [
            ".github/prompts/my-prompt.prompt.md",
            ".github/agents/my-agent.agent.md"
          ]
        },
        "checksum": {
          "type": "string",
          "description": "SHA256 checksum of the file contents",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "additionalProperties": false
    },
    "sourceEntry": {
      "type": "object",
      "description": "Source configuration entry",
      "required": [
        "type",
        "url"
      ],
      "properties": {
        "type": {
          "type": "string",
          "description": "Source type",
          "enum": [
            "github",
            "gitlab",
            "http",
            "local",
            "awesome-copilot",
            "local-awesome-copilot",
            "apm",
            "local-apm",
            "olaf",
            "local-olaf"
          ]
        },
        "url": {
          "type": "string",
          "description": "URL of the source",
          "minLength": 1
        },
        "branch": {
          "type": "string",
          "description": "Optional Git branch for git-based sources"
        }
      },
      "additionalProperties": false
    },
    "hubEntry": {
      "type": "object",
      "description": "Hub configuration entry",
      "required": [
        "name",
        "url"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name of the hub",
          "minLength": 1
        },
        "url": {
          "type": "string",
          "description": "URL of the hub configuration",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "profileEntry": {
      "type": "object",
      "description": "Profile entry in the lockfile",
      "required": [
        "name",
        "bundleIds"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name of the profile",
          "minLength": 1
        },
        "bundleIds": {
          "type": "array",
          "description": "List of bundle IDs included in this profile",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      },
      "additionalProperties": false
    }
  }
}
